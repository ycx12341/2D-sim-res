}
ess.obj.ind <- which(abs(ess.mat.valid[,2] - ess.target) ==
min(abs(ess.mat.valid[,2] - ess.target)))
ess.obj <- ess.mat.valid[ess.obj.ind,2]
bw.obj <- ess.mat.valid[ess.obj.ind,1]
wt.obj <- ss.mat.valid[,2]^(-bw.obj)
resamp.prob.obj <- rep(0, length = length(ss.mat.valid[,1]))
for (k in 1:length(wt.obj)) {
if (wt.obj[k] == min(wt.obj)) {
resamp.prob.obj[k] <- 0
} else if (wt.obj[k] == max(wt.obj)) {
resamp.prob.obj[k] <- 1
} else {
resamp.prob.obj[k] <- (wt.obj[k]-min(wt.obj))/(max(wt.obj)-min(wt.obj))
}
}
info.list <- list(info.mat = cbind(ss.mat.valid, wt.obj, resamp.prob.obj),
ess.mat = ess.mat,
ess.obj = ess.obj,
bw.obj = bw.obj)
return(info.list)
}
setwd("~/Academia Yunchen/Glioma simulations/Second set of invasion pattern/40_40 (less fixed static time wider r prior correct chi 5ps)/Coverage test on run 3 final result")
paras.r7 <- read.table("Round 7 parameters.txt", sep = "", header = TRUE)
sims.dir <- "LS_results_r7"
ls.r7 <- read.table("Round 7 Least Square.txt", sep = "", header = TRUE)
length(which(is.na(ls.r7[,2]))) # 0, all output from the posterior sample are valid.
# Observed densities
ref.den <- read_rds("Glioma simulation full reference densities.rds")
# Unperturbed model output
paras.r7.output <- vector(mode = "list")
for (i in 1:length(ls.r7[,2])) {
res.temp <- read_rds(paste0("./", sims.dir,
"/Round_7_paras",i,"_res.rds"))
ls.temp.d1 <- res.temp$den.mat.d1
ls.temp.d3 <- res.temp$den.mat.d3
ls.temp <- list(den.mat.d1 = ls.temp.d1,
den.mat.d3 = ls.temp.d3)
paras.r7.output[[i]] <- ls.temp
print(i)
names(paras.r7.output)[i] <- paste0("ls_r7_",i)
}
write_rds(paras.r7.output, "Full output paras r7 run 3.rds")
View(ls.r7)
ls.r7.min <- read_rds("Round_7_paras7209_res.rds")
sd.r7.d1.min <- sd(ls.r7.min$den.mat.d1 - ref.den$t1.ref.den)
sd.r7.d3.min <- sd(ls.r7.min$den.mat.d3 - ref.den$t3.ref.den)
paras.r7.output.pert <- vector(mode = "list")
set.seed(874514)
RNGkind(sample.kind = "Rejection")
for (i in 1:length(paras.r7.output)) {
ls.temp <- paras.r7.output[[i]]
# Read the unperturbed data
den.mat.d1.temp.unpert <- ls.temp$den.mat.d1
den.mat.d3.temp.unpert <- ls.temp$den.mat.d3
# Create empty matrices to store perturbed data
den.mat.d1.temp.pert <- matrix(0, nrow = nrow(den.mat.d1.temp.unpert),
ncol = ncol(den.mat.d1.temp.unpert))
den.mat.d3.temp.pert <- matrix(0, nrow = nrow(den.mat.d3.temp.unpert),
ncol = ncol(den.mat.d3.temp.unpert))
# Add perturbation (to non-zero data only)
for (j in 1:length(den.mat.d1.temp.unpert)) {
if(den.mat.d1.temp.unpert[j] != 0) {
den.mat.d1.temp.pert[j] <- rnorm(1, den.mat.d1.temp.unpert[j], sd = sd.r7.d1.min)
while (den.mat.d1.temp.pert[j] < 0 || den.mat.d1.temp.pert[j] > 1) {
den.mat.d1.temp.pert[j] <- rnorm(1, den.mat.d1.temp.unpert[j], sd = sd.r7.d1.min)
}
}
if (den.mat.d3.temp.unpert[j] != 0) {
den.mat.d3.temp.pert[j] <- rnorm(1, den.mat.d3.temp.unpert[j], sd = sd.r7.d3.min)
while (den.mat.d3.temp.pert[j] < 0 || den.mat.d3.temp.pert[j] > 1) {
den.mat.d3.temp.pert[j] <- rnorm(1, den.mat.d3.temp.unpert[j], sd = sd.r7.d3.min)
}
}
}
# Sum of squared differences between the perturbed densities and the observed densities
sse.d1.temp <- sum((ref.den$t1.ref.den - den.mat.d1.temp.pert)^2)
sse.d3.temp <- sum((ref.den$t3.ref.den - den.mat.d3.temp.pert)^2)
diff.temp.pert <- sum(sse.d1.temp, sse.d3.temp)
# Store each set of perturbed data into the list
paras.r7.output.pert[[i]] <- list(den.mat.d1.pert = den.mat.d1.temp.pert,
den.mat.d3.pert = den.mat.d3.temp.pert,
diff = diff.temp.pert)
# Name the elements in the list with correct indices
names(paras.r7.output.pert)[i] <- paste0("ls_r7_",i,"_pert")
print(i)
}
# Sort the sum of squared differences
ls.r7.pert <- matrix(0, nrow = length(ls.r7[,2])
,ncol = 2)
for (i in 1:length(ls.r7[,2])) {
ls.r7.pert[i,] <- c(i, as.double(paras.r7.output.pert[[i]]$diff))
}
View(ls.r7.pert)
ls.r7.pert.sort <- order(ls.r7.pert[,2])
ls.r7.pert.sort.min <- ls.r7.pert.sort[1:200]
# Extract out the corresponding 200 perturbed model outputs that have the
# minimum discrepancy with the reference data.
paras.r7.output.pert.full <- paras.r7.output.pert
paras.r7.output.pert <- paras.r7.output.pert[ls.r7.pert.sort.min]
View(paras.r7.output.pert)
ls.r7.diff.mat <- vector(mode = "list")
for (i in 1:length(paras.r7.output.pert)) {
# For each perturbed dataset, record its discrepancy with other unperturbed
# model output, corresponding weights and resampling probabilities.
diff.mat <- matrix(0, nrow = length(paras.r7[,2]), ncol = 2)
paras.r7.output.pert.temp <- paras.r7.output.pert[[i]]
for (j in 1:length(paras.r7[,2])) {
# Read in the unperturbed model output.
res.temp <- paras.r7.output[[j]]
# Calculate the sum of squared differences between the unperturbed model output and the
# selected set of perturbed data.
sse.d1.temp <- sum((res.temp$den.mat.d1 - paras.r7.output.pert.temp$den.mat.d1.pert)^2)
sse.d3.temp <- sum((res.temp$den.mat.d3 - paras.r7.output.pert.temp$den.mat.d3.pert)^2)
diff.temp <- sum(sse.d1.temp, sse.d3.temp)
# Append index, discrepancy and weights into the first three elements of each row
# of the matrix
diff.mat[j, 1:2] <- c(j, diff.temp)
# print(j)
}
# Remove the parameter set that corresponds to the current perturbed model output
diff.mat <- diff.mat[-ls.r7.pert.sort.min[i],]
# Store the info matrix in the list and name it with the corresponding index
ls.r7.diff.mat[[i]] <- diff.mat
names(ls.r7.diff.mat)[i] <- paste0("diff_mat_r7_",ls.r7.pert.sort.min[i])
# Progress tracking
print(i)
}
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_3032, lb.bw = 4.0, ub.bw = 4.1, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_3032, lb.bw = 4.9, ub.bw = 5.0, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_3032, lb.bw = 4.5, ub.bw = 4.6, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_3032, lb.bw = 4.6, ub.bw = 4.7, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_3032, lb.bw = 4.7, ub.bw = 4.8, ess.target = 2250, step.size = 0.01)
View(kkk)
ls.r7.crage <- vector(mode = "list")
for (i in 1:length(ls.r7.diff.mat)) {
diff.mat.temp <- ls.r7.diff.mat[[i]]
lb.bw.temp <- 4.7
ub.bw.temp <- 4.8
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
while (info.list.temp$bw.obj == lb.bw.temp || info.list.temp$bw.obj == ub.bw.temp) {
if (info.list.temp$bw.obj == lb.bw.temp) {
lb.bw.temp <- lb.bw.temp - 0.1
ub.bw.temp <- lb.bw.temp + 0.01
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
} else if (info.list.temp$bw.obj == ub.bw.temp) {
lb.bw.temp <- ub.bw.temp - 0.01
ub.bw.temp <- ub.bw.temp + 0.1
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
}
}
ls.r7.crage[[i]] <- info.list.temp
names(ls.r7.crage)[i] <- paste0("info_list_r7_",ls.r7.pert.sort.min[i])
print(c(i, info.list.temp$bw.obj, info.list.temp$ess.obj))
}
View(paras.r7.output.pert)
# Save the results into a .rds file
write_rds(ls.r7.crage, "Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_non_zero.rds")
# Probabilities and check if they fit uniform distributions
paras.r7 <- cbind(seq(1,10000,by = 1), paras.r7)
# An empty matrix used to store all the coverage probabilities
# regarding each perturbed dataset.
cov.mat <- matrix(0, nrow = 200, ncol = (length(paras.r7[1,]) - 1))
# Coverage probabilities
for (i in 1:200) {
# Read in the information matrix regarding each perturbed dataset
info.mat.temp <- ls.r7.crage[[i]]$info.mat
# Remove the parameter set which generated the perturbed dataset,
# in order to keep the indices consistent
paras.r7.corres <- paras.r7[-ls.r7.pert.sort.min[i],]
# For each parameter, calculate its coverage probability
prob.vec <- vector()
for (j in 1:(length(paras.r7[1,]) - 1)) {
cov.ind.temp <- which(paras.r7.corres[, (j + 1)] <= paras.r7[ls.r7.pert.sort.min[i], (j + 1)])
prob.temp <- sum(info.mat.temp[cov.ind.temp, length(info.mat.temp[1,])])/sum(info.mat.temp[,length(info.mat.temp[1,])])
# prob.temp <- length(cov.ind.temp)/length(info.mat.temp[,8])
# prob.temp <- (1 + length(cov.ind.temp))/(2 + length(info.mat.temp[,8]))
prob.vec <- c(prob.vec, prob.temp)
}
# Store the coverage probability corresponding to each perturbed dataset into
# each row of the coverage probability matrix.
cov.mat[i, ] <- prob.vec
}
# Store the coverage probabilities
write.table(cov.mat, "Coverage probabilities glioma r7 d1 d3 perturbed separately non zero only.txt")
# Histograms
set.seed(874512)
unif.sample <- runif(200, 0, 1)
hist(cov.mat[,1], main = "Coverage check of dn",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,1], unif.sample)
hist(cov.mat[,2], main = "Coverage check of rn",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,2], unif.sample)
hist(cov.mat[,3], main = "Coverage check of R_{init.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,3], unif.sample)
hist(cov.mat[,4], main = "Coverage check of P_{ext.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,4], unif.sample)
hist(cov.mat[,5], main = "Coverage check of P_{mit.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,5], unif.sample)
paras.r7.output.pert <- vector(mode = "list")
set.seed(874514)
RNGkind(sample.kind = "Rejection")
for (i in 1:length(paras.r7.output)) {
ls.temp <- paras.r7.output[[i]]
# Read the unperturbed data
den.mat.d1.temp.unpert <- ls.temp$den.mat.d1
den.mat.d3.temp.unpert <- ls.temp$den.mat.d3
# Create empty matrices to store perturbed data
den.mat.d1.temp.pert <- matrix(0, nrow = nrow(den.mat.d1.temp.unpert),
ncol = ncol(den.mat.d1.temp.unpert))
den.mat.d3.temp.pert <- matrix(0, nrow = nrow(den.mat.d3.temp.unpert),
ncol = ncol(den.mat.d3.temp.unpert))
# Add perturbation (to non-zero data only)
for (j in 1:length(den.mat.d1.temp.unpert)) {
#if(den.mat.d1.temp.unpert[j] != 0) {
den.mat.d1.temp.pert[j] <- rnorm(1, den.mat.d1.temp.unpert[j], sd = sd.r7.d1.min)
while (den.mat.d1.temp.pert[j] < 0 || den.mat.d1.temp.pert[j] > 1) {
den.mat.d1.temp.pert[j] <- rnorm(1, den.mat.d1.temp.unpert[j], sd = sd.r7.d1.min)
}
#}
#if (den.mat.d3.temp.unpert[j] != 0) {
den.mat.d3.temp.pert[j] <- rnorm(1, den.mat.d3.temp.unpert[j], sd = sd.r7.d3.min)
while (den.mat.d3.temp.pert[j] < 0 || den.mat.d3.temp.pert[j] > 1) {
den.mat.d3.temp.pert[j] <- rnorm(1, den.mat.d3.temp.unpert[j], sd = sd.r7.d3.min)
}
#}
}
# Sum of squared differences between the perturbed densities and the observed densities
sse.d1.temp <- sum((ref.den$t1.ref.den - den.mat.d1.temp.pert)^2)
sse.d3.temp <- sum((ref.den$t3.ref.den - den.mat.d3.temp.pert)^2)
diff.temp.pert <- sum(sse.d1.temp, sse.d3.temp)
# Store each set of perturbed data into the list
paras.r7.output.pert[[i]] <- list(den.mat.d1.pert = den.mat.d1.temp.pert,
den.mat.d3.pert = den.mat.d3.temp.pert,
diff = diff.temp.pert)
# Name the elements in the list with correct indices
names(paras.r7.output.pert)[i] <- paste0("ls_r7_",i,"_pert")
print(i)
}
# Sort the sum of squared differences
ls.r7.pert <- matrix(0, nrow = length(ls.r7[,2])
,ncol = 2)
for (i in 1:length(ls.r7[,2])) {
ls.r7.pert[i,] <- c(i, as.double(paras.r7.output.pert[[i]]$diff))
}
ls.r7.pert.sort <- order(ls.r7.pert[,2])
ls.r7.pert.sort.min <- ls.r7.pert.sort[1:200]
View(ls.r7.pert)
# Extract out the corresponding 200 perturbed model outputs that have the
# minimum discrepancy with the reference data.
paras.r7.output.pert.full <- paras.r7.output.pert
paras.r7.output.pert <- paras.r7.output.pert[ls.r7.pert.sort.min]
View(paras.r7.output.pert)
ls.r7.diff.mat <- vector(mode = "list")
for (i in 1:length(paras.r7.output.pert)) {
# For each perturbed dataset, record its discrepancy with other unperturbed
# model output, corresponding weights and resampling probabilities.
diff.mat <- matrix(0, nrow = length(paras.r7[,2]), ncol = 2)
paras.r7.output.pert.temp <- paras.r7.output.pert[[i]]
for (j in 1:length(paras.r7[,2])) {
# Read in the unperturbed model output.
res.temp <- paras.r7.output[[j]]
# Calculate the sum of squared differences between the unperturbed model output and the
# selected set of perturbed data.
sse.d1.temp <- sum((res.temp$den.mat.d1 - paras.r7.output.pert.temp$den.mat.d1.pert)^2)
sse.d3.temp <- sum((res.temp$den.mat.d3 - paras.r7.output.pert.temp$den.mat.d3.pert)^2)
diff.temp <- sum(sse.d1.temp, sse.d3.temp)
# Append index, discrepancy and weights into the first three elements of each row
# of the matrix
diff.mat[j, 1:2] <- c(j, diff.temp)
# print(j)
}
# Remove the parameter set that corresponds to the current perturbed model output
diff.mat <- diff.mat[-ls.r7.pert.sort.min[i],]
# Store the info matrix in the list and name it with the corresponding index
ls.r7.diff.mat[[i]] <- diff.mat
names(ls.r7.diff.mat)[i] <- paste0("diff_mat_r7_",ls.r7.pert.sort.min[i])
# Progress tracking
print(i)
}
View(paras.r7.output.pert)
View(ls.r7.diff.mat)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_6379, lb.bw = 8.5, ub.bw = 8.6, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_6379, lb.bw = 9.0, ub.bw = 9.1, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_6379, lb.bw = 9.5, ub.bw = 9.6, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_6379, lb.bw = 9.7, ub.bw = 9.8, ess.target = 2250, step.size = 0.01)
View(kkk)
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_6379, lb.bw = 9.8, ub.bw = 9.9, ess.target = 2250, step.size = 0.01)
View(kkk)
ls.r7.crage <- vector(mode = "list")
for (i in 1:length(ls.r7.diff.mat)) {
diff.mat.temp <- ls.r7.diff.mat[[i]]
lb.bw.temp <- 9.8
ub.bw.temp <- 9.9
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
while (info.list.temp$bw.obj == lb.bw.temp || info.list.temp$bw.obj == ub.bw.temp) {
if (info.list.temp$bw.obj == lb.bw.temp) {
lb.bw.temp <- lb.bw.temp - 0.1
ub.bw.temp <- lb.bw.temp + 0.01
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
} else if (info.list.temp$bw.obj == ub.bw.temp) {
lb.bw.temp <- ub.bw.temp - 0.01
ub.bw.temp <- ub.bw.temp + 0.1
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
}
}
ls.r7.crage[[i]] <- info.list.temp
names(ls.r7.crage)[i] <- paste0("info_list_r7_",ls.r7.pert.sort.min[i])
print(c(i, info.list.temp$bw.obj, info.list.temp$ess.obj))
}
View(ls.r7.crage)
ls.r7.pert[88, 2]
ls.r7.pert[88, ]
View(ls.r7.diff.mat)
View(ls.r7.diff.mat)
View(ls.r7.pert)
ls.r7.pert.sort[88]
calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_9553, lb.bw = 9.8, ub.bw = 9.9, ess.target = 2250, step.size = 0.01)
View(ls.r7.crage)
write_rds(ls.r7.crage, "Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_non_zero_1_87.rds")
View(paras.r7.output.pert)
write_rds(ls.r7.crage, "Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_1_87.rds")
ls.r7.crage <- vector(mode = "list")
for (i in 88:length(ls.r7.diff.mat)) {
diff.mat.temp <- ls.r7.diff.mat[[i]]
lb.bw.temp <- 11.0
ub.bw.temp <- 11.1
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
while (info.list.temp$bw.obj == lb.bw.temp || info.list.temp$bw.obj == ub.bw.temp) {
if (info.list.temp$bw.obj == lb.bw.temp) {
lb.bw.temp <- lb.bw.temp - 0.1
ub.bw.temp <- lb.bw.temp + 0.01
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
} else if (info.list.temp$bw.obj == ub.bw.temp) {
lb.bw.temp <- ub.bw.temp - 0.01
ub.bw.temp <- ub.bw.temp + 0.1
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
}
}
ls.r7.crage[[i]] <- info.list.temp
names(ls.r7.crage)[i] <- paste0("info_list_r7_",ls.r7.pert.sort.min[i])
print(c(i, info.list.temp$bw.obj, info.list.temp$ess.obj))
}
kkk <- calculate.bw(ss.mat = ls.r7.diff.mat$diff_mat_r7_9553, lb.bw = 12.3, ub.bw = 12.4, ess.target = 2250, step.size = 0.01)
View(kkk)
ls.r7.crage <- vector(mode = "list")
for (i in 88:length(ls.r7.diff.mat)) {
diff.mat.temp <- ls.r7.diff.mat[[i]]
lb.bw.temp <- 12.3
ub.bw.temp <- 12.4
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
while (info.list.temp$bw.obj == lb.bw.temp || info.list.temp$bw.obj == ub.bw.temp) {
if (info.list.temp$bw.obj == lb.bw.temp) {
lb.bw.temp <- lb.bw.temp - 0.1
ub.bw.temp <- lb.bw.temp + 0.01
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
} else if (info.list.temp$bw.obj == ub.bw.temp) {
lb.bw.temp <- ub.bw.temp - 0.01
ub.bw.temp <- ub.bw.temp + 0.1
info.list.temp <- calculate.bw(ss.mat = diff.mat.temp, lb.bw = lb.bw.temp,
ub.bw = ub.bw.temp, ess.target = 2250,
step.size = 0.01)
}
}
ls.r7.crage[[i]] <- info.list.temp
names(ls.r7.crage)[i] <- paste0("info_list_r7_",ls.r7.pert.sort.min[i])
print(c(i, info.list.temp$bw.obj, info.list.temp$ess.obj))
}
write_rds(ls.r7.crage, "Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_88_200.rds")
# Combine the two files into one
sep.pert.pt1 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_1_87.rds")
sep.pert.pt2 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_88_200.rds")
View(sep.pert.pt2)
View(ls.r7.crage)
ls.r7.pert.sort
ls.r7.pert.sort.min
ls.r7.pert.sort.min[88]
ls.r7.pert.sort.min[89]
for (i in 1:length(sep.pert.pt1)) {
sep.pert.pt2[[i]] <- sep.pert.pt1[[i]]
}
View(sep.pert.pt2)
sep.pert.pt2[["NA"]]
names(sep.pert.pt1[[1]])
names(sep.pert.pt1[1])
# Combine the two files into one
sep.pert.pt1 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_1_87.rds")
sep.pert.pt2 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_88_200.rds")
for (i in 1:length(sep.pert.pt1)) {
sep.pert.pt2[i] <- sep.pert.pt1[i]
}
View(sep.pert.pt2)
View(sep.pert.pt2)
View(sep.pert.pt1)
i
# Combine the two files into one
sep.pert.pt1 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_1_87.rds")
sep.pert.pt2 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_88_200.rds")
View(sep.pert.pt2)
sep.pert.pt2[1]
sep.pert.pt2[1] <- sep.pert.pt1[1]
sep.pert.pt2[1]
View(sep.pert.pt2)
sep.pert.pt2[["NA"]]
# Combine the two files into one
sep.pert.pt1 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_1_87.rds")
sep.pert.pt2 <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep_88_200.rds")
for (i in 1:length(sep.pert.pt1)) {
sep.pert.pt2[[i]] <- sep.pert.pt1[[i]]
names(sep.pert.pt2)[i] <- names(sep.pert.pt1)[i]
}
View(sep.pert.pt2)
write_rds(sep.pert.pt2, "Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep.rds")
ls.r7.crage <- read_rds("Coverage_test_disp_wt_prob_r7_d1_d3_pert_sep.rds")
View(ls.r7.crage)
# An empty matrix used to store all the coverage probabilities
# regarding each perturbed dataset.
cov.mat <- matrix(0, nrow = 200, ncol = (length(paras.r7[1,]) - 1))
# Coverage probabilities
for (i in 1:200) {
# Read in the information matrix regarding each perturbed dataset
info.mat.temp <- ls.r7.crage[[i]]$info.mat
# Remove the parameter set which generated the perturbed dataset,
# in order to keep the indices consistent
paras.r7.corres <- paras.r7[-ls.r7.pert.sort.min[i],]
# For each parameter, calculate its coverage probability
prob.vec <- vector()
for (j in 1:(length(paras.r7[1,]) - 1)) {
cov.ind.temp <- which(paras.r7.corres[, (j + 1)] <= paras.r7[ls.r7.pert.sort.min[i], (j + 1)])
prob.temp <- sum(info.mat.temp[cov.ind.temp, length(info.mat.temp[1,])])/sum(info.mat.temp[,length(info.mat.temp[1,])])
# prob.temp <- length(cov.ind.temp)/length(info.mat.temp[,8])
# prob.temp <- (1 + length(cov.ind.temp))/(2 + length(info.mat.temp[,8]))
prob.vec <- c(prob.vec, prob.temp)
}
# Store the coverage probability corresponding to each perturbed dataset into
# each row of the coverage probability matrix.
cov.mat[i, ] <- prob.vec
}
write.table(cov.mat, "Coverage probabilities glioma r7 d1 d3 perturbed separately.txt")
# Histograms
set.seed(874514)
unif.sample <- runif(200, 0, 1)
hist(cov.mat[,1], main = "Coverage check of dn",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,1], unif.sample)
hist(cov.mat[,2], main = "Coverage check of rn",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,2], unif.sample)
hist(cov.mat[,3], main = "Coverage check of R_{init.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,3], unif.sample)
hist(cov.mat[,4], main = "Coverage check of P_{ext.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,4], unif.sample)
hist(cov.mat[,5], main = "Coverage check of P_{mit.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,5], unif.sample)
cov.mat <- read.table("Coverage probabilities glioma r3 d1 d3 perturbed separately non zero only.txt", sep = "",
header = TRUE)
cov.mat <- read.table("Coverage probabilities glioma r7 d1 d3 perturbed separately non zero only.txt", sep = "",
header = TRUE)
# Histograms
set.seed(874514)
unif.sample <- runif(200, 0, 1)
hist(cov.mat[,1], main = "Coverage check of dn",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,1], unif.sample)
hist(cov.mat[,2], main = "Coverage check of rn",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,2], unif.sample)
hist(cov.mat[,3], main = "Coverage check of R_{init.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,3], unif.sample)
hist(cov.mat[,4], main = "Coverage check of P_{ext.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,4], unif.sample)
hist(cov.mat[,5], main = "Coverage check of P_{mit.}",
xlim = c(0,1), xlab = "Probabilities")
ks.test(cov.mat[,5], unif.sample)
